<Window x:Class="TodoTasks.View.TasksWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:vm="clr-namespace:TodoTasks.ViewModel"
        xmlns:c="clr-namespace:TodoTasks.ViewModel.Converters"
        mc:Ignorable="d"
        Title="To Do tasks" Height="600" Width="900"
        MinHeight="150" MinWidth="250">

    <Window.Resources>
        <vm:TasksViewModel x:Key="vm"/>
        <c:BooltoVis x:Key="BooltoVis"/>
        <c:BooltoVisOpposite x:Key="BooltoVisOpposite"/>
    </Window.Resources>

    
    <DockPanel DataContext="{StaticResource vm}">
        
        <!--Tasklist Panel-->
        <StackPanel DockPanel.Dock="Left" Width="200" HorizontalAlignment="Left"
                        Background="#252527">

            <TextBlock Text="Task lists" FontSize="18" Foreground="Violet" Margin="7,5,5,0" />

            <ListView ItemsSource="{Binding TasklistList}" BorderThickness="0" 
                      SelectedItem="{Binding SelectedTasklist, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      Background="Transparent" Margin="15,5,10,5">
                
                <ListView.ItemContainerStyle>
                    <Style TargetType="{x:Type ListViewItem}">

                        <Setter Property="Width" Value="Auto"/>
                        <Setter Property="HorizontalAlignment" Value="Left"/>
                        <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                        <Setter Property="Template">

                            <Setter.Value>
                                <ControlTemplate TargetType="{x:Type ListViewItem}">
                                    <Grid x:Name="myListViewGrid">
                                        <ContentPresenter />
                                    </Grid>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="myListViewGrid" Property="Background" Value="#303030"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="myListViewGrid" Property="Background" Value="#303030"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                    
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListView.ItemContainerStyle>
                
                <ListView.ItemTemplate>
                    
                    <DataTemplate>
                        <Grid>
                            <TextBlock Text="{Binding Name}" Style="{Binding Source={StaticResource myTextblockStyle}}"
                                       Visibility="{Binding Source={StaticResource vm}, Path=IsTasklistRenaming, 
                                                 Converter={StaticResource BooltoVisOpposite}}"/>

                            <TextBox Text="{Binding Name, Mode=TwoWay}" Style="{StaticResource myRenamingTextboxStyle}"
                                     Visibility="{Binding Source={StaticResource vm}, Path=IsTasklistRenaming, 
                                                 Converter={StaticResource BooltoVis}}" />
                            <b:Interaction.Triggers>
                                <b:EventTrigger EventName="LostFocus">
                                    <b:InvokeCommandAction Command="{Binding Source={StaticResource vm}, Path=EndRenameCommand}"
                                                               CommandParameter="{Binding Source={StaticResource vm}, Path=SelectedTasklist}" />
                                </b:EventTrigger>
                            </b:Interaction.Triggers>

                            <Grid.ContextMenu>
                                <ContextMenu DataContext="{StaticResource vm}">
                                    <MenuItem Header="Rename list" Command="{Binding StartRenameCommand}"  CommandParameter="{Binding SelectedTasklist}" />
                                    <MenuItem Header="Duplicate list"/>
                                    <Separator/>
                                    <MenuItem Header="Delete list"/>
                                </ContextMenu>
                            </Grid.ContextMenu>        
                        </Grid>

                    </DataTemplate>
                </ListView.ItemTemplate>
                
                
            </ListView>

            <Button Style="{StaticResource myButtonStyle}" Content="+New list" Margin="10,5,5,5"
                    Command="{Binding NewTasklistCommand}"/>
            
        </StackPanel>

        <!--Subtask Panel-->
        <StackPanel DockPanel.Dock="Right" Width="270" HorizontalAlignment="Right"
                    Background="#252527">

            <ListView Background="Transparent" Margin="10,5,10,5">

            </ListView>

            <Button Style="{StaticResource myButtonStyle}" Content="+Next step" Margin="15,5,5,5"/>

        </StackPanel>

        <!--Tasks-->
        <!--Add a task -->
        <StackPanel DockPanel.Dock="Bottom" Background="#191919">
            <Grid>
                <TextBox Style="{StaticResource myTextBoxPromptStyle}" Text=" + Add a task" Focusable="False"/>
                <TextBox Style="{StaticResource myTextBoxStyle}" AcceptsReturn="False">
                    <TextBox.InputBindings>
                        <KeyBinding Key="Return"
                                        Command="{Binding NewTaskCommand}"
                                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType={x:Type TextBox}} , Path=Text }" />
                    </TextBox.InputBindings>
                </TextBox>
            </Grid>
        </StackPanel>

        <!--List of Tasks in task list -->
        <StackPanel Background="#191919">
            <TextBlock Text="{Binding SelectedTasklist.Name}" Foreground="Gainsboro" FontSize="22" FontWeight="DemiBold" Margin="25,10,5,5"/>

            <ListView ItemsSource="{Binding TasksList}"
                      SelectedItem="{Binding SelectedTask}"
                      Background="Transparent" Margin="25,10,25,5">

            </ListView>
        </StackPanel>

    </DockPanel>

</Window>
